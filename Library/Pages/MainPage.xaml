<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:dg="clr-namespace:Maui.DataGrid;assembly=Maui.DataGrid"
             x:Class="Library.Pages.MainPage"
             xmlns:viewmodel="clr-namespace:Library.ViewModels"
             x:DataType="viewmodel:MainViewModel" Loaded="ContentPage_Loaded" FlowDirection="RightToLeft">
    <ContentPage.Resources>
        <Style  x:Key="heading" TargetType="Label">
            <Setter Property="Background" Value="#ccc"/>
            <Setter Property="Padding" Value="5"></Setter>
            <Setter Property="FontAttributes" Value="Bold"></Setter>

        </Style>
       
        <Style  x:Key="cell" TargetType="Label">
            <!--<Style.Triggers>
                <Trigger TargetType="Label" Property="Background" Value="yellow"/>
            </Style.Triggers>-->

        </Style>
         <Style TargetType="Grid" x:Key="BookRow">
          <Style.Triggers>
                                <DataTrigger TargetType="Grid" Binding="{Binding IsSelected}" Value="True">
                                    <Setter Property="BackgroundColor" Value="aqua"/>
                                </DataTrigger>
                                <DataTrigger TargetType="Grid" Binding="{Binding IsSelected}" Value="False">
                                    <Setter Property="BackgroundColor" Value="White"/>
                                </DataTrigger>
                            </Style.Triggers>

</Style>
        <Style  x:Key="headingBorder" TargetType="Border">
            <Setter Property="Stroke" Value="black"></Setter>
        </Style>
    </ContentPage.Resources>
    <ContentPage.ToolbarItems>
        <ToolbarItem Text="کتاب جدید" Command="{Binding AddBookCommand}" Order="Primary" IsEnabled="True"/>
        <ToolbarItem Text="ویرایش" Command="{Binding EditBookCommand}" Order="Primary" IsEnabled="{Binding CanEdit}"/>
        <ToolbarItem Text="حذف" Command="{Binding DeleteBookCommand}"  IsEnabled="{Binding CanDelete}"/>
        <ToolbarItem Text="جستجو" Command="{Binding ToggleSearchCommand}" Order="Primary"/>
    </ContentPage.ToolbarItems>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="92*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="100*"/>
        </Grid.ColumnDefinitions>
        <FlexLayout Grid.Row="0" IsVisible="{Binding IsSearchMode}" Wrap="NoWrap">
        <Entry Placeholder="جستجو"   FlexLayout.Grow="1" x:Name="SearchText" Text="{Binding SearchText}"/>
     <Button Text="جستجو" Command="{Binding SearchCommand}"/>
     </FlexLayout>
        <ScrollView Grid.Row="1">
            <Grid RowDefinitions="100*" ColumnDefinitions="*">
                <CollectionView ItemsSource="{Binding Books}"
                ItemsLayout="VerticalGrid" SelectedItem="{Binding SelectedItem}" SelectionMode="Single" SelectionChangedCommand="{Binding SelectedBookChangedCommand}" >
                  

                    <CollectionView.Header>
                        <Grid>                      
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="25*" />
                                <ColumnDefinition Width="15*"/>
                                <ColumnDefinition Width="10*"/>
                                <ColumnDefinition Width="10*"/>
                                <ColumnDefinition Width="10*"/>
                                <ColumnDefinition Width="10*"/>
                                <ColumnDefinition Width="5*"/>
                                <ColumnDefinition Width="15*"/>
                            </Grid.ColumnDefinitions>
                            <Border Grid.Column="0" Style="{StaticResource Key=headingBorder}">
                                <Label Grid.Column="0" Text="تصویر جلد" Style="{StaticResource heading}"  />
                            </Border>
                            <Border Grid.Column="1" Style="{StaticResource Key=headingBorder}">
                                <Label Grid.Column="7" Text="عنوان" Style="{StaticResource heading}"/>
                            </Border>
                            <Border Grid.Column="2" Style="{StaticResource Key=headingBorder}">
                                <Label Grid.Column="1" Text="نویسنده" Style="{StaticResource heading}"/>
                            </Border>
                            <Border Grid.Column="3" Style="{StaticResource Key=headingBorder}">
                                <Label Grid.Column="2" Text="ناشر"  Style="{StaticResource heading}"/>
                            </Border>
                            <Border Grid.Column="4" Style="{StaticResource Key=headingBorder}">
                                <Label Grid.Column="3" Text="مترجم" Style="{StaticResource heading}"/>
                            </Border>
                            <Border Grid.Column="5" Style="{StaticResource Key=headingBorder}">
                                <Label Grid.Column="4" Text="قیمت" Style="{StaticResource heading}"/>
                            </Border>
                            <Border Grid.Column="6" Style="{StaticResource Key=headingBorder}">
                                <Label Grid.Column="5" Text="توضیح" Style="{StaticResource heading}"/>
                            </Border>
                            <Border Grid.Column="7" Style="{StaticResource Key=headingBorder}">
                                <Label Grid.Column="6" Text="زبان" Style="{StaticResource heading}"/>
                            </Border>

                        </Grid>
                    </CollectionView.Header>
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="viewmodel:BookViewModel">
                        <!--    <SwipeView>
                     <SwipeView.RightItems>
                        <SwipeItems Mode="Execute">
                            <SwipeItem 
                            Text="Delete" 
                            Command="{Binding DeleteBookCommand,Source={RelativeSource AncestorType={x:Type viewmodel:MainViewModel}}}" 
                            CommandParameter="{Binding Id}" BackgroundColor="Red"/>
                        </SwipeItems>
                    </SwipeView.RightItems> -->
                            <Grid Padding="10,10,10,0" Style="{StaticResource BookRow}" >
      

                                <Grid.RowDefinitions>
                                    <RowDefinition />
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="25*" />
                                    <ColumnDefinition Width="15*"/>
                                    <ColumnDefinition Width="10*"/>
                                    <ColumnDefinition Width="10*"/>
                                    <ColumnDefinition Width="10*"/>
                                    <ColumnDefinition Width="10*"/>
                                    <ColumnDefinition Width="5*"/>
                                    <ColumnDefinition Width="15*"/>
                                </Grid.ColumnDefinitions>

                                <Image Grid.Column="0" Source="{Binding CoverImage}" Style="{StaticResource cell}"  MaximumHeightRequest="100"/>
                                <Label Grid.Column="1" Text="{Binding Title}" Style="{StaticResource cell}"/>



                                <Label Grid.Column="2" Text="{Binding Author}" Style="{StaticResource cell}"/>

                                <Label Grid.Column="3" Text="{Binding Publisher}" Style="{StaticResource cell}"/>
                                <Label Grid.Column="4" Text="{Binding Translator}" Style="{StaticResource cell}"/>
                                <Label Grid.Column="5" Text="{Binding Price}" Style="{StaticResource cell}"/>
                                <Label Grid.Column="6" Text="{Binding Description}" Style="{StaticResource cell}"/>
                                <Label Grid.Column="7" Text="{Binding Language}" Style="{StaticResource cell}"/>

                            </Grid>
                            <!-- </SwipeView> -->
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </Grid>
        </ScrollView>
        <Grid Grid.Row="2" HorizontalOptions="Fill" BackgroundColor="Azure" Margin="0,20,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="33*"/>
                <ColumnDefinition Width="33*"/>
                <ColumnDefinition Width="33*"/>
            </Grid.ColumnDefinitions>
            <Button ImageSource="{FontImageSource   Glyph='&#x000002C3;'}" Grid.Column="0" HorizontalOptions="Fill" Command="{Binding PreviousPageCommand}" IsEnabled="{Binding CanNavigatePreviousPage}"/>
            <HorizontalStackLayout Grid.Column="1" HorizontalOptions="Center">
                <Label Text="{Binding CurrentPage}" />
                <Label Text=" از "/>
                <Label Text="{Binding TotalPages}" />
            </HorizontalStackLayout>
            <Button Grid.Column="2" HorizontalOptions="Fill" ImageSource="{FontImageSource   Glyph='&#x000002C2;'}" Command="{Binding NextPageCommand}" IsEnabled="{Binding CanNavigateNextPage}"/>
        </Grid>
    </Grid>
</ContentPage>
