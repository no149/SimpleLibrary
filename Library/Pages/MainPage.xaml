<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:dg="clr-namespace:Maui.DataGrid;assembly=Maui.DataGrid"
             x:Class="Library.Pages.MainPage"
             xmlns:viewmodel="clr-namespace:Library.ViewModels"
             x:DataType="viewmodel:MainViewModel" Loaded="ContentPage_Loaded"             
             >
    <ContentPage.Resources>

        <Style  x:Key="heading" TargetType="Label">
            <Setter Property="Background" Value="#ccc"/>
            <Setter Property="Padding" Value="5"></Setter>
            <Setter Property="FontAttributes" Value="Bold"></Setter>

        </Style>
        <Style  x:Key="row" TargetType="Grid">
            <Style.Triggers>
                <DataTrigger TargetType="CollectionView" Binding="{Binding SelectedItem}" Value="{x:Null}">
                    <Setter Property="Background" Value="aqua" TargetName="BookRow"/>
                </DataTrigger>
            </Style.Triggers>

        </Style>
        <Style  x:Key="cell" TargetType="Label">
            <!--<Style.Triggers>
                <Trigger TargetType="Label" Property="Background" Value="yellow"/>
            </Style.Triggers>-->

        </Style>
        <Style  x:Key="headingBorder" TargetType="Border">
            <Setter Property="Stroke" Value="black"></Setter>
        </Style>
    </ContentPage.Resources>
    <ScrollView>
        <Grid RowDefinitions="80*,20*" ColumnDefinitions="*">

            <!--<dg:DataGrid ItemsSource="{Binding Books}" SelectionEnabled="True" SelectedItem="{Binding SelectedItem}"
                RowHeight="70" HeaderHeight="50" 
                HeaderBordersVisible="true"
                 IsRefreshing="false" PaginationEnabled="false" PageSize="5">
                
                <dg:DataGrid.Columns>

                    <dg:DataGridColumn Title="Title" PropertyName="Title" IsVisible="true" Width="100"/>
                    <dg:DataGridColumn Title="Author" PropertyName="Author" Width="0.5*" />
                    <dg:DataGridColumn Title="Publisher" PropertyName="Publisher" Width="0.5*" />
                    <dg:DataGridColumn Title="Translator" PropertyName="Translator" Width="0.5*" />
                    <dg:DataGridColumn Title="Language" PropertyName="Language" Width="0.5*" />
                    <dg:DataGridColumn Title="Price" PropertyName="Price" Width="0.5*" IsVisible="true" />
                    <dg:DataGridColumn Title="CoverImage" PropertyName="CoverImage" Width="0.5*" />
                    <dg:DataGridColumn Title="Description" PropertyName="Description" Width="0.5*" />

                </dg:DataGrid.Columns>
                <dg:DataGrid.RowsBackgroundColorPalette>
                    <dg:PaletteCollection>
                        <Color>#F2F2F2</Color>
                        <Color>#FFFFFF</Color>
                    </dg:PaletteCollection>
                </dg:DataGrid.RowsBackgroundColorPalette>
                <dg:DataGrid.ControlTemplate>
                    <ControlTemplate>
                    <dg:DataGridRow DataGrid="{Reference self}" HeightRequest="{Binding RowHeight, Source={Reference self}, Mode=OneTime}" />
                    </ControlTemplate>
                </dg:DataGrid.ControlTemplate>
            </dg:DataGrid>-->
            <CollectionView ItemsSource="{Binding Books}"
                ItemsLayout="VerticalGrid" SelectionMode="Single" SelectedItem="{Binding SelectedItem}">
                <CollectionView.Style>
                    <Style TargetType="Grid">
                        <Style.Triggers>
                            <DataTrigger TargetType="CollectionView" Binding="{Binding IsBookSelected}" Value="True">
                                <Setter Property="BackgroundColor" Value="aqua"/>
                            </DataTrigger>
                            <DataTrigger TargetType="CollectionView" Binding="{Binding IsBookSelected}" Value="False">
                                <Setter Property="BackgroundColor" Value="White"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </CollectionView.Style>
                <CollectionView.Header>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition x:Name="TitleColumn" Width="200" />
                            <ColumnDefinition x:Name="AuthorColumn" Width="200" />
                            <ColumnDefinition x:Name="PublisherColumn" Width="200" />
                            <ColumnDefinition x:Name="TranslatorColumn" Width="200" />
                            <ColumnDefinition x:Name="PriceColumn" Width="200" />
                            <ColumnDefinition x:Name="DescriptionColumn" Width="200" />
                            <ColumnDefinition x:Name="LanguageColumn" Width="200" />
                        </Grid.ColumnDefinitions>
                      
                        <Border Grid.Column="0" Style="{StaticResource Key=headingBorder}">
                            <Label  Text="عنوان"  Style="{StaticResource Key=heading}"/>
                        </Border>
                        <Border Grid.Column="1" Style="{StaticResource Key=headingBorder}">
                            <Label  Text="نویسنده"  Style="{StaticResource Key=heading}"/>
                        </Border>
                        <Border Grid.Column="2" Style="{StaticResource Key=headingBorder}">
                            <Label  Text="انتشارات" Style="{StaticResource Key=heading}"/>
                        </Border>
                        <Border Grid.Column="3" Style="{StaticResource Key=headingBorder}">
                            <Label  Text="مترجم" Style="{StaticResource Key=heading}"/>
                        </Border>
                        <Border Grid.Column="4" Style="{StaticResource Key=headingBorder}">
                            <Label  Text="قیمت" Style="{StaticResource Key=heading}"/>
                        </Border>
                        <Border Grid.Column="5" Style="{StaticResource Key=headingBorder}">
                            <Label  Text="توضیح" Style="{StaticResource Key=heading}"/>
                        </Border>
                        <Border Grid.Column="6" Style="{StaticResource Key=headingBorder}">
                            <Label  Text="زبان" Style="{StaticResource Key=heading}"/>
                        </Border>
                  
                    </Grid>
                </CollectionView.Header>
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="viewmodel:BookViewModel">
                        <Grid Padding="10,0" x:Name="BookRow">
                            <Grid.RowDefinitions>
                                <RowDefinition />
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="200" />
                                <ColumnDefinition Width="200"/>
                                <ColumnDefinition Width="200"/>
                                <ColumnDefinition Width="200"/>
                                <ColumnDefinition Width="200"/>
                                <ColumnDefinition Width="200"/>
                                <ColumnDefinition Width="200"/>
                            </Grid.ColumnDefinitions>
                            
                            <StackLayout Style="{StaticResource cell}" Grid.Column="0">
                                <Label  Text="{Binding Title}" Style="{StaticResource cell}"/>
                                <BoxView HeightRequest="1" HorizontalOptions="FillAndExpand" VerticalOptions="StartAndExpand" Color="#ccc"/>
                            </StackLayout>
                            <StackLayout Style="{StaticResource cell}" Grid.Column="1">
                                <Label  Text="{Binding Author}" Style="{StaticResource cell}"/>
                                <BoxView HeightRequest="1" HorizontalOptions="FillAndExpand" VerticalOptions="StartAndExpand" Color="#ccc"/>
                            </StackLayout>
                            <StackLayout Style="{StaticResource cell}" Grid.Column="2">
                                <Label  Text="{Binding Publisher}" Style="{StaticResource cell}"/>
                                <BoxView HeightRequest="1" HorizontalOptions="FillAndExpand" VerticalOptions="StartAndExpand" Color="#ccc"/>
                            </StackLayout>
                            <StackLayout Style="{StaticResource cell}" Grid.Column="3">
                                <Label Grid.Column="3" Text="{Binding Translator}" Style="{StaticResource cell}"/>
                                <BoxView HeightRequest="1" HorizontalOptions="FillAndExpand" VerticalOptions="StartAndExpand" Color="#ccc"/>
                            </StackLayout>
                            <StackLayout Style="{StaticResource cell}" Grid.Column="4">
                                <Label Grid.Column="4" Text="{Binding Price}" Style="{StaticResource cell}"/>
                                <BoxView HeightRequest="1" HorizontalOptions="FillAndExpand" VerticalOptions="StartAndExpand" Color="#ccc"/>
                            </StackLayout>
                            <StackLayout Style="{StaticResource cell}" Grid.Column="5">
                                <Label Grid.Column="5" Text="{Binding Description}" Style="{StaticResource cell}"/>
                                <BoxView HeightRequest="1" HorizontalOptions="FillAndExpand" VerticalOptions="StartAndExpand" Color="#ccc"/>
                            </StackLayout>
                            <StackLayout Style="{StaticResource cell}" Grid.Column="6">
                                <Label Grid.Column="6" Text="{Binding Language}" Style="{StaticResource cell}"/>
                                <BoxView HeightRequest="1" HorizontalOptions="FillAndExpand" VerticalOptions="StartAndExpand" Color="#ccc"/>
                            </StackLayout>
                        </Grid>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
            <Button Text="{Binding EditButtonText}" Grid.Row="1" MinimumHeightRequest="10" Command="{Binding AddOrEditBookCommand}"></Button>
        </Grid>
    </ScrollView>
</ContentPage>
